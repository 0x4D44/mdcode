# Design Review — Coverage 98% Strategy

Date: 2025-10-31

Summary
- Strategy focuses on high‑leverage tests, PATH shims, and measurement tuning.
- Early implementation (P1) is in place; coverage moved to ~78% Tarpaulin / ~75% LLVM.

Findings
- Duplicate `main()` in `src/lib.rs` was dragging coverage; removed (binary `main` remains in `src/main.rs`).
- GhCreate path had no coverage; now tested for conflicts, dot‑dir name, and CLI non‑zero.
- Diff had untested error branches; covered non‑numeric/two‑arg modes and diff tool dual failure.
- Info loop needed ≥20 commits; added an integration test.

Issues / Adjustments
- Some branches (e.g., `H` modes) hit “Remote 'origin' not found” earlier than index parse errors; tests accept both outcomes and still execute code paths.
- Windows‑specific diff tooling cannot be launched in CI; direct error test keeps those lines covered without flakiness.
- GH API fallback remains untested by design (networkless). Future: feature‑gated stub to exercise serialization and control flow.

Next Steps (P2)
- Tagging edge cases: force overwrite, push happy path already covered; add explicit overwrite‑existing error test.
- gh_push: simulate merge conflict to cover printed guidance and error return path.
- is_dirty: add rename/typechange coverage and ensure EOL normalization branch is exercised on CRLF/LF scenarios.
- read_version_from_cargo_toml: add missing file and malformed TOML tests.

Measurement
- Keep Makefile targets; optionally add `coverage-llvm-lib` with `--lib` for gating once branches are saturated.

Go/No‑Go
- GO for P2 tests and optional `offline_gh` feature in a follow‑up.

